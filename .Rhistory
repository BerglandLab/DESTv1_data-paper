library(adegenet)
library(tidyverse)
library(magrittr)
library(reshape2)
library(vroom)
library(reshape2)
library(FactoMineR)
library(factoextra)
library(vcfR)
library(patchwork)
library(reshape2)
library(zoo)
library(matrixStats)
library(data.table)
library(SeqArray)
library(LEA)
library(gdsfmt)
library(SNPRelate)
library(patchwork)
library(rnaturalearth)
library(rnaturalearthdata)
library(ggExtra)
library(vcfR)
setwd("/Users/jcbnunez/Documents/GitHub/data-paper")
load("/Figures9_and_11/data/DEST_DGN_AllSNPs_Metadata.Rdata")
load("./Figures9_and_11/data/DEST_DGN_AllSNPs_Metadata.Rdata")
dat_filt_maf_LD500_naimp %>% PCA(scale.unit = F, graph = F, ncp = 50) -> LD500_naimp_PCA_50PCs_object
LD500_naimp_PCA_50PCs_object$ind$coord %>% as.data.frame() %>% mutate(sampleId = rownames(.)) %>% left_join(., DEST_DGN_metadata) -> PCA_coords_metadata
PC1_PVE=round(LD500_naimp_PCA_50PCs_object$eig[1,2],2)
PC2_PVE=round(LD500_naimp_PCA_50PCs_object$eig[2,2],2)
PC3_PVE=round(LD500_naimp_PCA_50PCs_object$eig[3,2],2)
#Graph
label.df_PCA <- PCA_coords_metadata %>%
group_by(country) %>%
summarize(Dim.1 = mean(Dim.1), Dim.2 = mean(Dim.2), Dim.3 = mean(Dim.3), Dim.4 = mean(Dim.4) )
ggplot() + geom_vline(xintercept = 0, linetype = "dashed") + geom_hline(yintercept = 0, linetype = "dashed") + geom_point(data =PCA_coords_metadata ,  aes(x=Dim.1, y=Dim.2, fill = as.factor(country), shape = as.factor(Continental_clusters)),size = 3,  alpha = 0.8)  +  ggrepel::geom_label_repel(data = label.df_PCA, size = 1.7 ,  alpha = 0.7, aes(x=Dim.1, y=Dim.2, ,label = country))  + theme_classic() + theme(legend.position = "none") + xlab("PC 1 (24% VE)") + ylab("PC 2 (9% VE)") + scale_shape_manual(values = c(21,22,23,24)) -> DEST_Woldwide_PCA12
ggplot() + geom_vline(xintercept = 0, linetype = "dashed") + geom_hline(yintercept = 0, linetype = "dashed") + geom_point(data =PCA_coords_metadata ,  aes(x=Dim.1, y=Dim.3, fill = as.factor(country), shape = as.factor(Continental_clusters)),size = 3,  alpha = 0.8)  +  ggrepel::geom_label_repel(data = label.df_PCA, size = 1.7 ,  alpha = 0.7, aes(x=Dim.1, y=Dim.3, ,label = country))  + theme_classic() + theme(legend.position = "none") + xlab("PC 1 (24% VE)") + ylab("PC 3 (3.9% VE)") + scale_shape_manual(values = c(21,22,23,24))  -> DEST_Woldwide_PCA13
DEST_Woldwide_PCA13
#Graph maps
world <- ne_countries(scale = "medium", returnclass = "sf")
class(world)
ggplot(data = world) +
geom_sf(fill= "antiquewhite") +
coord_sf(xlim = c(-125.15, 45.00), ylim = c(-43.00, 65.00), expand = FALSE) + theme(panel.grid.major = element_line(color = gray(.5), linetype = "dashed", size = 0.5), panel.background = element_rect(fill = "aliceblue")) + geom_point(data =PCA_coords_metadata , aes(x=as.numeric(long), y=as.numeric(lat), fill = (Dim.1), shape = as.factor(Continental_clusters)),size = 2.5,  alpha = 0.7)  +
scale_fill_gradient(low = "steelblue", high = "firebrick", na.value = NA) + xlab("Lon") + ylab("Lat") + ggtitle("PC 1 projections onto World Map") + theme(legend.position = "none") + scale_shape_manual(values = c(21,22,23,24)) -> Wolrd_PC1
#ggsave("Wolrd_PC1.pdf",(Wolrd_PC1),  width = 6, height = 4)
####PC 2
ggplot(data = world) +
geom_sf(fill= "antiquewhite") +
coord_sf(xlim =  c(-12, 41.00), ylim = c(32.00, 63.00), expand = FALSE) + theme(panel.grid.major = element_line(color = gray(.5), linetype = "dashed", size = 0.5), panel.background = element_rect(fill = "aliceblue")) + geom_point(data =PCA_coords_metadata , aes(x=as.numeric(long), y=as.numeric(lat), fill = (Dim.3), shape = as.factor(Continental_clusters)),size = 2.5,  alpha = 0.7)  +
scale_fill_gradient2(low = "steelblue", high = "darkblue", na.value = NA) + xlab("Lon") + ylab("Lat") + ggtitle("PC 3 projections onto World Map") + theme(legend.position = "none") + scale_shape_manual(values = c(21,22,23,24)) -> Wolrd_PC3
Wolrd_PC3
ggplot(data = world) +
geom_sf(fill= "antiquewhite") +
coord_sf(xlim = c(-125.15, 45.00), ylim = c(-43.00, 65.00), expand = FALSE) + theme(panel.grid.major = element_line(color = gray(.5), linetype = "dashed", size = 0.5), panel.background = element_rect(fill = "aliceblue")) + geom_point(data =PCA_coords_metadata , aes(x=as.numeric(long), y=as.numeric(lat), fill = (Dim.1), shape = as.factor(Continental_clusters)),size = 2.5,  alpha = 0.7)  +
scale_fill_gradient(low = "steelblue", high = "firebrick", na.value = NA) + xlab("Lon") + ylab("Lat") + ggtitle("PC 1 projections onto World Map") + scale_shape_manual(values = c(21,22,23,24)) -> PC1_guide
PC1_guide
ggplot(data = world) +
geom_sf(fill= "antiquewhite") +
coord_sf(xlim =  c(-12, 41.00), ylim = c(32.00, 63.00), expand = FALSE) + theme(panel.grid.major = element_line(color = gray(.5), linetype = "dashed", size = 0.5), panel.background = element_rect(fill = "aliceblue")) + geom_point(data =PCA_coords_metadata , aes(x=as.numeric(long), y=as.numeric(lat), fill = (Dim.3), shape = as.factor(Continental_clusters)),size = 2.5,  alpha = 0.7)  +
scale_fill_gradient2(low = "steelblue", high = "darkblue", na.value = NA) + xlab("Lon") + ylab("Lat") + ggtitle("PC 3 projections onto World Map") + scale_shape_manual(values = c(21,22,23,24)) -> Guide_PC3
Guide_PC3
